---

schema_version: 1

rules:
  - description: 'Test slow backend with infinite server timeouts'
    domains:
      - test
    matches:
      all:
        - paths:
            exact:
              - '/backend/timeout_server_infinite'
    actions:
      backend:
        timeout_server: 0
        servers:
          - server: 'http://127.0.0.1:4242'

tests:
  - name: 'Test that server responds'
    request:
      url: 'https://test/backend/timeout_server_infinite?sleep=0'
    expect:
      status: 200
      time_max: 2
  - name: 'Test that no timeout strikes on a 3s request (timeout_server_max=0, timeout_server_default=5, timeout_server=0)'
    request:
      url: 'https://test/backend/timeout_server_infinite?sleep=3'
    expect:
      status: 200
      time_min: 3
      time_max: 4

---

schema_version: 1

rules:
  - description: 'Test slow backend with custom server timeouts when max is set to infinite'
    domains:
      - test
    matches:
      all:
        - paths:
            exact:
              - '/backend/timeout_server_custom'
    actions:
      backend:
        timeout_server: 0.1
        servers:
          - server: 'http://127.0.0.1:4242'

tests:
  - name: 'Test that custom server timeout strikes (100ms) (timeout_server_max=0, timeout_server_default=5, timeout_server=0.1)'
    request:
      url: 'https://test/backend/timeout_server_custom?sleep=2'
    expect:
      status: 504
      time_min: 0
      time_max: 1
